# 01.5 - Bridging to Medallion Architecture

## Overview

Medallion architecture (Bronze ’ Silver ’ Gold layers) is a modern data organization pattern increasingly common in cloud data platforms like Azure Databricks, Fabric Lakehouses, and Snowflake. Understanding how your current Power BI star schema fits into this architecture prepares your team for future platform migrations and helps you design semantic models that align with organizational data strategy. This topic bridges the gap between traditional star schema design and modern data lakehouse patterns.

## Key Principles

- **Bronze Layer = Raw Data Landing**: Exact copy of source systems (EHR, billing, scheduling) with minimal transformationjust ingestion timestamps and data lineage metadata for compliance
- **Silver Layer = Cleaned & Conformed**: Data quality rules applied, duplicates removed, surrogate keys added, slowly-changing dimensions (SCD) implementedthis is where your star schema foundation lives
- **Gold Layer = Business-Ready Aggregates**: Pre-calculated aggregations, complex business rules applied, often materialized as star schema fact/dimension tables optimized for specific use cases
- **Power BI Semantic Models = Gold++**: Your Power BI model sits atop Gold layer tables, adding DAX measures, time intelligence, relationships, and security (RLS)this is the "presentation layer" for end users
- **Think Layered, Not Siloed**: Each layer builds on the previous one with clear lineage; changes in Silver propagate to Gold, changes in Gold impact your Power BI datasets

## Practical Examples

### Example 1: Mapping Your Current Star Schema to Medallion Layers

Let's say you've already implemented the star schema recommendations from [01.1 - Star Schema Design Principles](./01.1%20-%20Star%20Schema%20Design%20Principles.md) and [01.2 - Fact vs Dimension Tables](./01.2%20-%20Fact%20vs%20Dimension%20Tables.md). Here's how it maps to medallion architecture:

**Bronze Layer** (Raw Source Data):
```sql
-- Tables directly mirroring EHR source system
ABCDW.bronze.EHR_Patients_Raw
ABCDW.bronze.EHR_Encounters_Raw
ABCDW.bronze.EHR_Providers_Raw
ABCDW.bronze.Billing_Claims_Raw
ABCDW.bronze.Scheduling_Appointments_Raw

-- Includes ingestion metadata for audit trail (HIPAA requirement)
CREATE TABLE ABCDW.bronze.EHR_Patients_Raw (
    SourcePatientID VARCHAR(50),
    FirstName VARCHAR(100),
    LastName VARCHAR(100),
    DateOfBirth DATE,
    -- ... all source columns unchanged ...
    _IngestTimestamp DATETIME DEFAULT GETDATE(),
    _SourceSystem VARCHAR(50) DEFAULT 'EHR_Prod',
    _IngestJobID VARCHAR(100)
);
```

**Silver Layer** (Cleaned & Conformed):
```sql
-- Your current StarSchema views that clean data and add surrogate keys
ABCDW.silver.DimPatient
ABCDW.silver.DimProvider
ABCDW.silver.DimFacility
ABCDW.silver.DimPayer
ABCDW.silver.DimDate
ABCDW.silver.FactEncounter

-- Example: DimPatient with SCD Type 2 for address changes
CREATE VIEW ABCDW.silver.DimPatient AS
SELECT
    NEWID() AS PatientKey,  -- Surrogate key
    SourcePatientID,
    CONCAT(FirstName, ' ', LastName) AS PatientFullName,
    DATEDIFF(YEAR, DateOfBirth, GETDATE()) AS CurrentAge,
    -- Data quality: standardize NULL values
    COALESCE(PrimaryPhone, 'Unknown') AS PrimaryPhone,
    -- SCD columns for tracking changes
    EffectiveDate,
    ExpirationDate,
    IsCurrent
FROM ABCDW.bronze.EHR_Patients_Raw
WHERE IsDeleted = 0;  -- Exclude soft-deleted records
```

**Gold Layer** (Business-Ready Aggregates):
```sql
-- Pre-aggregated tables for common queries to improve performance
-- These reduce load on Power BI, especially for large datasets

CREATE TABLE ABCDW.gold.PatientCensusDaily AS
SELECT
    f.EncounterDate,
    f.FacilityKey,
    COUNT(DISTINCT f.PatientKey) AS UniquePatientsServed,
    SUM(f.EncounterDuration) AS TotalCareMinutes,
    AVG(f.PatientSatisfactionScore) AS AvgSatisfactionScore
FROM ABCDW.silver.FactEncounter f
GROUP BY f.EncounterDate, f.FacilityKey;

-- Power BI imports this smaller aggregated table instead of millions of encounter rows
-- Supports the <5 second load time SLA for daily huddle dashboards
```

**Power BI Semantic Model** (What you import):
- Import Gold layer tables: `PatientCensusDaily`, `ProviderProductivity`, `PayerMix`
- Import Silver dimensions: `DimPatient`, `DimProvider`, `DimFacility`, `DimDate`
- Add DAX measures: YTD calculations, variance analysis, time intelligence
- Add RLS: Provider sees only their attributed patients
- Add display folders: Clinical Metrics, Financial Metrics, Productivity

**Why this works**: Your Power BI model is the presentation layer sitting atop a well-architected data platform. You import clean, performant data from Silver/Gold layers and focus your DAX efforts on business logic (measures) rather than data cleaning (which belongs in Silver).

### Example 2: Incremental Migration Path (Current State ’ Medallion)

You don't have to rebuild your entire data platform overnight. Here's a pragmatic migration approach for AbsoluteCare:

**Phase 1: Foundation (Current State - You're Here)**
- Continue using Power BI with SQL views as your "Silver layer equivalent"
- Create star schema views in SQL database (see [01.2](./01.2%20-%20Fact%20vs%20Dimension%20Tables.md))
- Document data transformations happening in Power Query
- Identify which transformations should move to SQL (query folding benefits)

**Phase 2: Bronze Layer Preparation (3-6 months)**
- Create `ABCDW.bronze` schema in existing SQL database
- Start landing raw EHR extracts into Bronze tables with ingestion metadata
- No impact to Power BI yetcontinue using existing views
- Build audit trail for HIPAA compliance (who changed what when)

**Phase 3: Silver Layer Formalization (6-12 months)**
- Migrate your SQL views to formal `ABCDW.silver` schema
- Implement SCD Type 2 for key dimensions (Patient address changes, Provider facility assignments)
- Add data quality checks: duplicate detection, referential integrity validation
- Power BI connections remain unchanged (just point to new schema)

**Phase 4: Gold Layer Performance Optimization (12-18 months)**
- Identify slow Power BI reports (use [02.4 - Performance Analyzer](../02%20-%20Performance%20Optimization%20&%20Query%20Design/02.4%20-%20Performance%20Analyzer%20Workflow.md))
- Create Gold aggregation tables for daily huddle reports (pre-calculate patient census, provider productivity)
- Implement incremental refresh on Gold tables (see [02.3](../02%20-%20Performance%20Optimization%20&%20Query%20Design/02.3%20-%20Incremental%20Refresh%20Strategies.md))
- Power BI imports smaller Gold tables instead of large Silver fact tables

**Phase 5: Platform Modernization (Future State)**
- Evaluate cloud data lakehouse platforms (Azure Fabric, Databricks)
- Migrate Bronze/Silver/Gold layers to lakehouse (Delta Lake format)
- Power BI connects via Direct Lake mode (DirectQuery performance with Import experience)
- Benefit from unified analytics platform (data engineering + BI + data science)

**Current priority**: Phases 1-2 (documenting transformations and establishing Bronze landing zone)

## Common Pitfalls

### Pitfall 1: Mixing Layer Responsibilities
Doing data cleansing transformations in Power Query that should be in Silver layer, or implementing complex business logic in Silver that belongs in Gold or DAX measures.

**Impact**: Power Query transformations break query folding (slow performance), business logic in wrong layer makes changes difficult to propagate, transformations repeated across multiple Power BI reports instead of centralized.

**Example**: Using Power Query to remove duplicate patients, calculate patient age, or implement complex inclusion/exclusion criteria. These transformations should be in Silver layer SQL views where they're reusable across all downstream reports.

### Pitfall 2: Skipping Bronze Layer as "Unnecessary"
Believing Bronze layer is only for big enterprises, so you go straight from source systems to Silver layer with transformations.

**Impact**: No audit trail of raw source data (HIPAA compliance risk), can't replay transformations if business rules change, can't troubleshoot data quality issues by comparing raw vs. cleaned data, loss of historical raw data if source systems purge old records.

**Example**: An EHR system update changes patient name formatting from "Last, First" to "First Last". Without Bronze layer history, you can't reconstruct what the data looked like before the change. With Bronze, you have timestamped snapshots of every ingestion for compliance and debugging.

### Pitfall 3: Creating "Gold" Aggregations Too Early
Building highly specific aggregation tables in Gold layer before understanding reporting patterns, leading to unused tables and wasted ETL effort.

**Impact**: Gold layer becomes cluttered with rarely-used aggregation tables, ETL refresh times increase unnecessarily, maintenance burden grows without corresponding business value, users confused about which table to use.

**Example**: Creating `PatientCensusDaily`, `PatientCensusWeekly`, `PatientCensusMonthly`, `PatientCensusByProvider`, `PatientCensusByFacility`, `PatientCensusByPayer` without knowing which aggregations reports actually need. Better approach: Start with detailed Silver layer, monitor Performance Analyzer to identify slow queries, then create targeted Gold aggregations for those specific patterns.

### Pitfall 4: Confusing Medallion Architecture with Physical Storage
Thinking Bronze/Silver/Gold must be separate databases or separate cloud storage accounts, adding unnecessary complexity.

**Impact**: Over-engineered data platform for your current scale, increased infrastructure costs, complex networking and security configurations, delays in getting value from the architecture.

**Example**: You have 4 Power BI reports and ~100 users, but you provision separate Azure storage accounts, separate Databricks clusters, and separate SQL databases for Bronze/Silver/Gold. For your scale, a single database with schemas (`ABCDW.bronze`, `ABCDW.silver`, `ABCDW.gold`) is perfectly appropriate. Medallion is a logical organization pattern, not a physical infrastructure mandate.

## Healthcare Context

### Performance Considerations

Medallion architecture directly supports your **<5 second load time SLA** for clinical workflows:

- **Gold layer aggregations**: Pre-calculate daily patient census, provider productivity, payer mix. Power BI imports 365 rows (one per day) instead of 500,000 encounter rows. Daily huddle report loads in <2 seconds instead of 8-12 seconds.
- **Silver layer optimization**: Implementing SCD Type 2 in SQL (Silver) instead of Power Query means query folding works, database does the heavy lifting, Power BI receives only current/active dimension records.
- **Direct Lake mode (future)**: When you migrate to Azure Fabric, Direct Lake provides DirectQuery-like freshness with Import-like speedbest of both worlds for clinical dashboards.

### Compliance & Audit Trail

HIPAA requires demonstrable data lineage and audit trails for PHI access:

- **Bronze layer timestamp metadata**: Every raw data ingestion tagged with `_IngestTimestamp`, `_SourceSystem`, `_IngestJobID`. If a patient disputes care records, you can trace back to exact EHR extract.
- **Silver layer change tracking**: SCD Type 2 on dimensions maintains full history of patient address changes, provider facility assignments. Supports "patient record as of date" compliance queries.
- **Gold layer aggregation lineage**: Document which Silver tables feed which Gold aggregations. When a quality metric is questioned, you can trace calculation back through layers to raw source.

### Migration Risk Mitigation

Healthcare organizations can't afford downtime for provider-facing reports:

- **Incremental migration approach**: Phases 1-4 allow you to adopt medallion architecture gradually without disrupting current Power BI reports
- **Parallel operation**: During Phase 3 (Silver formalization), run old and new schemas in parallel, validate data matches, then cut overzero downtime
- **Rollback capability**: Keep old SQL views intact until new Silver/Gold layers proven stable (3+ months in production)

## Learn More

### Official Documentation
- [Microsoft Fabric Medallion Architecture](https://learn.microsoft.com/en-us/fabric/onelake/onelake-medallion-lakehouse-architecture) - Overview of Bronze/Silver/Gold layers in Fabric Lakehouse
- [Azure Databricks Medallion Architecture](https://www.databricks.com/glossary/medallion-architecture) - Original popularization of the pattern with Delta Lake
- [Microsoft Fabric Direct Lake Mode](https://learn.microsoft.com/en-us/power-bi/enterprise/directlake-overview) - Future state connection mode for Power BI on Fabric

### Expert Resources
- [James Serra's Blog - Medallion Architecture Explained](https://www.jamesserra.com/archive/2023/01/medallion-architecture/) - Practical overview from Microsoft Data Platform MVP
- [SQLBI - Fabric and Power BI Integration](https://www.sqlbi.com/articles/power-bi-and-microsoft-fabric/) - Marco Russo's analysis of how Power BI fits into Fabric medallion architecture
- [Kimball Group - Conformed Dimensions in Medallion Context](https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/kimball-techniques/dimensional-modeling-techniques/) - Dimensional modeling techniques that align with Silver/Gold layers

### Video Content
- [Guy in a Cube - What is Medallion Architecture?](https://www.youtube.com/c/GuyinaCube) - Patrick LeBlanc and Adam Saxton explain Bronze/Silver/Gold with Fabric examples
- [Advancing Analytics - Medallion Architecture Deep Dive](https://www.youtube.com/c/AdvancingAnalytics) - Simon Whiteley's practical implementation walkthrough

### Related Topics
- [01.1 - Star Schema Design Principles](./01.1%20-%20Star%20Schema%20Design%20Principles.md) - Foundation of Silver layer dimension tables
- [01.2 - Fact vs Dimension Tables](./01.2%20-%20Fact%20vs%20Dimension%20Tables.md) - Silver layer table design patterns
- [02.3 - Incremental Refresh Strategies](../02%20-%20Performance%20Optimization%20&%20Query%20Design/02.3%20-%20Incremental%20Refresh%20Strategies.md) - How Gold layer aggregations benefit from incremental refresh
- [06.3 - Deployment Pipelines & CI-CD](../06%20-%20Governance%20Security%20&%20Deployment/06.3%20-%20Deployment%20Pipelines%20&%20CI-CD.md) - Automating deployment across Bronze/Silver/Gold layers

---

*Last updated: October 21, 2025*
